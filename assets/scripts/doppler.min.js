// Copyright: Raven N. Allan (c) 2015, https://github.com/geekindapink/TheDopplerEffect
(function(e){var c=document.getElementById("starCanvas"),b=c.getContext("2d"),a={blue:[0,0,255],red:[255,0,0]},d={init:function(){d.drawImg("./assets/images/star.png").manipulatePixels(a.blue,"starBlue").manipulatePixels(a.red,"starRed").bindUI()},drawImg:function(g){var f=new Image();f.src=g;b.drawImage(f,0,0,300,150);return d},manipulatePixels:function(h,g){var k,m=b.getImageData(0,0,300,150),j=m.data,f=j.length,l=document.getElementById(g);for(k=0;k<f;k+=4){j[k]=h[0];j[k+1]=h[1];j[k+2]=h[2]}b.putImageData(m,0,0);l.src=c.toDataURL("image/png");return d},bindUI:function(){var o=-100,q=10000,i=1,r=10000,m=101,j=Math.log(i),s=Math.log(r),v=(s-j)/(r-i),k=e("#velocityInput"),f=e("#velocitySlider"),g=e("#starCanvas"),p=e("#starBlue"),t=e("#starGold"),l=e("#starRed");function n(){var y=Number(e(this).val());if(y<o){y=o;k.val(y)}else{if(y>q){y=q;k.val(y)}}var z=(y<0)?m-Math.abs(y):m+y,x=(Math.log(z)-j)/(v+i);f.val(x);h()}function u(){var y=Math.exp(e(this).val()),x=(y<m)?-(m-y):y-m;k.val(x.toFixed(1));h()}function h(){var B,y=0.5,x=200,A=Number(k.val());if(A<0){B=Math.abs(A)/x;l.css("opacity",0);p.css("opacity",B);var z=B+y;t.css("opacity",z)}else{if(A>0){B=(A<=100)?A/x:y;p.css("opacity",0);l.css("opacity",B);t.css("opacity",y)}}}var w=Math.log(m)/(v+i);f.attr("min",j).attr("max",s).val(w);k.bind("input",n);f.on("input",u);e(window).on("resize",function(){var x=t.height(),y=t.position();g.height(x).width(x).css("left",y.left)}).trigger("resize");return d}};d.init()}(jQuery));